<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM8s Brushless MCP: Zero Crossing Point Estimation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">STM8s Brushless MCP
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Brushless motor controller on STM8s</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('zeropoint.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Zero Crossing Point Estimation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_docs_md_zeropoint"></a> There are a number of ways that the zero-crossing point can be estimated from the back-EMF voltage measurement.</p>
<h2><a class="anchor" id="autotoc_md24"></a>
Hardware comparator</h2>
<p>The most straightforward way to get the exact time of the zero-crossing point with no estimation required is to integrate a hardware comparator into the circuit (feature of the A/D peripheral on some MCUs). The comparator takes the neutral point voltage and the phase voltage and output an external trigger to the MCU when the condition switches at the ZCP.</p>
<h2><a class="anchor" id="autotoc_md25"></a>
Midpoint estimation method</h2>
<p>The challenge of trying to use the back-EMF signal directly lies in part with the noise present in the sensor (unfiltered resistor divider) and also in timing the measurement, since the system (motor) is inherently of sync to begin with. To detect the time of the zero-crossing point, the addition of a comparator to the circuit can provide an external trigger at exact time of the ZCP. In this way there is a ready error signal with the desired setpoint for the ZCP time to be exactly midway (30-degrees).</p>
<p>Estimation of the ZCP from sampling the back-EMF voltage is based on timing the sample acquisition to acquire 1 sample at 15 degrees and 1 sample at 45 degrees, where the two should add to 0 once the motor is in time and the ZCP is occuring at 30 degrees. It seems to be problematic with this approach as the availability of number of samples is linked to the motor speed as well as PWM frequency.</p>
<h2><a class="anchor" id="autotoc_md26"></a>
Integration approach</h2>
<p>Estimation of the ZCP from sampling the back-EMF voltage is based on averaging as many samples as occur over the 60-degrees duration of the floating sector of the measured phase. The premise being that a timed motor will have equal distribution of the area under the back-EMF curve around the zero-crossing point as the ZCP should occur at exactly halfway point during the floating-phase time period (30-degrees).</p>
<p>Instead of comparing the average to the ideal neutral voltage, the error comparison is done between the btdc samples and the atdc samples. The ratio between the average of the atdc and btdc sides of the trapezoid ranges from 1/1 when the motor is in time and proportionately above or below one to the amount of timing error ( error = atdc/btdc - 1).</p>
<p>The Commutation Timer is configured to interrupt at 4-times the intended commutation switching rate, such that the Timer ISR shall occur 4 times during each commutation period (i.e. at 15 degree intervals within a given 60-degree commutation sector).</p>
<p>ADC start conversion is triggered by the System Timer (PWM rising edge).</p>
<p>The battery voltage measurement is obtained by taking the A/D measurement during the active PWM driving section of the commutation period.</p>
<div class="plantumlgraph">
<img src="inline_umlgraph_23.png" />
</div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
